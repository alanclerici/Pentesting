#!/usr/bin/env python3
import argparse
import subprocess
import re
from termcolor import colored

def getArgs():
    args = argparse.ArgumentParser(description='Interfaz de consola para el escaneo de puertos con NMAP')
    args.add_argument("-i","--ip", dest="ip",required=True, help="IP objetivo (Ej: -i 192.168.0.1)")
    args.add_argument("-p","--puertos", dest="puertos",default='80', help="Puertos a escanear, 80 por defecto")
    salida = args.parse_args()

    return salida.ip ,salida.puertos

def escaneo(ip,puertos):
    print(colored(f"\n----- [ ESCANEO DE VERSIONES ] -----\n","green"))
    subprocess.run(["nmap",ip,"-Pn",'-sC',"-sV","-p",puertos,"--max-rtt-timeout","10000ms"])
    print(colored(f"\n----- [ SCRIPTs DE NMAP ] -----\n","green"))
    subprocess.run(["nmap",ip,"-Pn",'--script',"vuln and safe","-p",puertos])
    puertos = puertos.split(',')
    if '80' in puertos:
        print(colored(f"\n----- [ WHATWEB ] -----\n","green"))
        subprocess.run(["whatweb",ip])

def main():
    ip, puertos = getArgs()
    escaneo(ip,puertos)

if __name__ == '__main__':
    main()